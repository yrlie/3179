{
  "$schema": "https://vega.github.io/schema/vega-lite/v5.json",
  "width": 760,
  "height": 400,
  "projection": {"type": "mercator", "center": [108.05, 4], "scale": 2550},
  "layer": [
    {
      "data": {"sphere": true},
      "mark": {"type": "geoshape", "fill": "#d6eaf2"}
    },
    {
      "data": {"graticule": {"step": [5, 5]}},
      "mark": {"type": "geoshape", "stroke": "#bfcad0"}
    },
    {
      "data": {
      "url": "https://raw.githubusercontent.com/yrlie/3179/refs/heads/main/DV2/js/malaysia_states.topojson",
      "format": {"type": "topojson", "feature": "states"}
      },
      "transform": [
        {
          "lookup": "properties.Name",
          "from": {
            "data": {
              "url": "https://raw.githubusercontent.com/yrlie/3179/refs/heads/main/DV2/data/number_addicts_by_state.csv"
            },
            "key": "Name",
            "fields": ["Cases", "Population"]
          }
        },
        {
          "calculate": "datum.Cases / datum.Population * 100000", "as": "Cases per 100k Population"
        },
        {
          "calculate" : "geoCentroid(null, datum)",
          "as" : "centroid"
        },
        {
            "calculate" : "datum.centroid[0]",
            "as" : "centroidx"
        },
        {
            "calculate" : "datum.centroid[1]",
            "as" : "centroidy"
        }
      ],
      "selection": {
        "state_select": {
          "type": "single",
          "fields": ["properties.Name"],
          "bind": {
            "input": "select",
            "options": ["Johor","Kedah","Kelantan","Melaka","Negeri Sembilan","Pahang","Penang","Perak","Perlis","Sabah","Sarawak","Selangor","Terengganu","Kuala Lumpur","Labuan","Putrajaya"],
            "name": "Select State: "
          },
          "empty": "none"
        },
        "hover": {
          "type": "single",
          "fields": ["properties.Name"],
          "on": "mouseover",
          "clear": "mouseout",
          "empty": "none"
        }
      },
      "layer": [
        {
          "mark": {
            "type": "geoshape",
            "stroke": "gray",
            "strokeWidth": 0.4
          },
          "selection": {
            "state_select": {
              "type": "single",
              "fields": ["properties.Name"],
              "bind": {
                "input": "select",
                "options": ["Johor","Kedah","Kelantan","Melaka","Negeri Sembilan","Pahang","Penang","Perak","Perlis","Sabah","Sarawak","Selangor","Terengganu","Kuala Lumpur","Labuan","Putrajaya"],
                "name": "Select State: "
              },
              "empty": "none"
            },
            "hover": {
              "type": "single",
              "fields": ["properties.Name"],
              "on": "mouseover",
              "clear": "mouseout",
              "empty": "none"
            }
          },
          "encoding": {
            "color": {
              "field": "Cases per 100k Population",
              "type": "quantitative",
              "scale": {"type": "log", "scheme": "orangered"},
              "legend": {
                "orient": "none",
                "direction": "horizontal",
                "title": "Cases per 100k Population",
                "titleFontSize": 11,
                "labelFontSize": 10,
                "gradientLength": 200,
                "gradientThickness": 15,
                "symbolType": "square",
                "legendX": 250,     
                "legendY": 60    
              }
            },
            "strokeWidth": {
              "condition": [
                {"selection": "hover", "value": 1},
                {"selection": "state_select", "value": 1}
              ],
              "value": 0.4
            },
            "stroke": {
              "condition": [
                {"selection": "hover", "value": "black"},
                {"selection": "state_select", "value": "black"}
              ],
              "value": "gray"
            },
            "opacity": {
              "condition": [
                {"selection": "hover", "value": 1},
                {"selection": "state_select", "value": 1}
              ],
              "value": 0.7
            },
            "tooltip": [
              {"field": "properties.Name", "type": "nominal", "title": "State"},
              {"field": "Cases", "type": "quantitative"},
              {"field": "Population", "type": "quantitative", "format": ","},
              {"field": "Cases per 100k Population", "type": "quantitative", "format": ".1f", "title": "Drug Addiction Cases per 100k Population"}
            ]
          }
        },
        {
          "mark": {
            "type": "text",
            "baseline": "middle",
            "color": "black",
            "align": "center",
            "dx": -15
          },
          "encoding": {
            "longitude": {"field": "centroidx", "type": "quantitative"},
            "latitude": {"field": "centroidy", "type": "quantitative"},
            "text": {"field": "properties.Name", "type": "nominal"},
            "size": {
              "condition": [
                {"selection": "hover", "value": 13},
                {"selection": "state_select", "value": 13}
              ],
              "value": 6.5
            },
            "tooltip": [
              {
                "condition": {"selection": "state_select"},
                "field": "properties.Name",
                "type": "nominal",
                "title": "State"
              },
              {
                "condition": {"selection": "state_select"},
                "field": "Cases",
                "type": "quantitative"
              },
              {
                "condition": {"selection": "state_select"},
                "field": "Population",
                "type": "quantitative",
                "format": ","
              },
              {
                "condition": {"selection": "state_select"},
                "field": "Cases per 100k Population",
                "type": "quantitative",
                "format": ".1f",
                "title": "Drug Addiction Cases per 100k Population"
              }
            ]

          }
        }
      ]
    }
  ]
}
